<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Feel Outside The Box</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" type="text/css" href="css/site.css" />
        <script type="text/javascript" src="js/enchant/enchant.js"></script>
        <script type="text/javascript" src="js/jquery/jquery-1.11.0.js"></script>
    </head>
    <body>
        <div id="header"><h1>Feel Outside The Box</h1></div>
        <hr />
        <div id="content">
            <div id="enchant-stage"></div>
        </div>
        <hr />
        <div id="footer">
            <ul>
                <li>
                    <span class="credits_title">Credits:</span>
                    <ul>
                        <li>Coded by <span class="credit">Katariina Pohjola</span> and <span class="credit">Mikko Sairo</span></li>
                        <li>Graphics by <span class="credit">Muura Parkkinen</span> and <span class="credit">Mira INSERTNAMEHERE</span></li>
                        <li>Audio by <span class="credit">Tapani INSERTNAMEHERE</span> and <span class="credit">INSERTNAMEHERE INSERTNAMEHERE</span></li>
                    </ul>
                </li>
            </ul>
        </div>
        <script type="text/javascript">
            var gamediv = $('#enchant-stage');
            window.onload = function() {
                enchant();
                
                var game = new Game(1024,600);
                game.preload('img/kissa.png', // NPCs
                             'img/tipu_1000x732.gif',
                             'img/laatikkohahmoW526.png',
                             'img/koalaW917.png',
                             'img/roskisW930.png',
                             'img/kentta_5000.gif', // UI and other objects
                             'img/viivaW176.png',
                             'img/ajatusW142.png',
                             'img/kuplaW958.png');
                game.onload = function() {
                    game.scale = 1;
                    game.fps = 20;
                    game.scenes = new Object();
                    
                    var startScene = new StartScene();
                    game.scenes.start = startScene;
                    
                    game.pushScene(game.scenes.start);
                };
                
                game.start();
                
                var StartScene = Class.create(Scene, {
                    game: Game.instance,
                    initialize: function() {
                        Scene.apply(this);
                        
                        this.backgroundColor = '#aaaaaa';

                        this.world = new World(5000, 5000, 'img/kentta_5000.gif');
                        this.addChild(this.world);
                        
                        this.title = new TitleLabel("Feel Outside The Box");
                        this.title.y = 50;
                        this.title.font = "32px Comic Sans MS";
                        this.addChild(this.title);
                        
                        this.subtitle = new TitleLabel("FGJ2014 - Pohjois-Karjala");
                        this.subtitle.y = 150;
                        this.subtitle.color = 'red';
                        this.addChild(this.subtitle);
                        
                        this.subtitle = new TitleLabel("Credits:\r\nNukiuchi, Katariina Pohjola, Muura, Myla");
                        this.subtitle.y = 250;
                        this.subtitle.color = 'blue';
                        this.addChild(this.subtitle);
                        
                        this.char = new Character(781,602);
                        this.addChild(this.char);
                        
                        
                        this.addEventListener(Event.TOUCH_START, this.onTouchStart);
                        this.addEventListener(Event.ENTER_FRAME, this.onEnterFrame);
                    },

                    onTouchStart: function(e) {
                        var gameScene = new GameScene();
                        game.scenes.game = gameScene;
                    
                        game.replaceScene(game.scenes.game);
                    },
                    onEnterFrame: function(e) {
                        //this.char.onEnterFrame(e);
                        this.world.rotate(-0.1);
                    }
                });
                
                var GameScene = Class.create(Scene, {
                    game: Game.instance,
                    initialize: function() {
                        Scene.apply(this);
                        
                        // Define the background or "world" object
                        this.world = new World(5000, 5000, 'img/kentta_5000.gif');
                        this.addChild(this.world);
                        this.originX = this.world.x;
                        this.backgroundColor = '#112255';
                        
                        // Define different GameObjects, or NPCs
                        this.npcs = new Array();
                        var cat = new GameObject(765,1984, 'img/kissa.png');
                        cat.distance = 1760;
                        cat.rotate(20);
                        this.addChild(cat);
                        this.npcs.push(cat);
                        
                        var coala = new GameObject(917,1084, 'img/koalaW917.png');
                        coala.distance = 1800;
                        coala.rotate(cat.rotation + 40);
                        this.addChild(coala);
                        this.npcs.push(coala);
                        
                        var boxguy = new GameObject(526, 1373, 'img/laatikkohahmoW526.png');
                        boxguy.distance = 1800;
                        boxguy.rotate(coala.rotation + 40);
                        this.addChild(boxguy);
                        this.npcs.push(boxguy);
                        
                        var trashbin = new GameObject(930, 1272, 'img/roskisW930.png');
                        trashbin.distance = 1808;
                        trashbin.rotate(boxguy.rotation + 40);
                        this.addChild(trashbin);
                        this.npcs.push(trashbin);
                        
                        this.rotateObjects(0);
                        
                        // Define the Player Character
                        this.char = new Character(781,602);
                        this.char.frame = [null];
                        this.addChild(this.char);
                        
                        // Define UI
                        this.clock = new Clock();
                        this.clock.timeSpeed = 3;
                        this.addChild(this.clock);
                        
                        //this.dialog = new Dialog("This is test dialog.");
                        //this.addChild(this.dialog);
                        
                        // Event bindings
                        this.addEventListener(Event.TOUCH_START, this.onTouchStart);
                        this.addEventListener(Event.ENTER_FRAME, this.onEnterFrame);
                        this.addEventListener(Event.RIGHT_BUTTON_DOWN, this.onRightButtonDown);
                        this.addEventListener(Event.RIGHT_BUTTON_UP, this.onRightButtonUp);
                        this.addEventListener(Event.LEFT_BUTTON_DOWN, this.onLeftButtonDown);
                        this.addEventListener(Event.LEFT_BUTTON_UP, this.onLeftButtonUp);
                        
                        // Flags for input and timers
                        this.rightButtonDown = false;
                        this.leftButtonDown = false;
                        this.timeElapsedObjects = 0;
                        this.timeElapsedChar = 0;
                        
                        // Variables for game speec and such
                        this.charUpdateSpeed = 0.01;
                        this.objectUpdateSpeed = 0.25;
                        this.worldRotationSpeed = 0.15;
                    },
                    
                    updateSkyColor: function() {
                        var hours = this.clock.hours;
                        if(hours > 22 || hours < 6) {
                            // Night
                            this.backgroundColor = '#000011';
                        } else if(hours >= 6 && hours < 11) {
                            switch(hours) {
                                case 6:
                                    this.backgroundColor = '#111122';
                                    break;
                                case 7:
                                    this.backgroundColor = '#337777';
                                    break;
                                case 8:
                                    this.backgroundColor = '#559999';
                                    break;
                                case 9:
                                    this.backgroundColor = '#77BBBB';
                                    break;
                                case 10:
                                    this.backgroundColor = '#99DDDD';
                                    break;
                            }
                        } else if(hours >= 18 && hours <= 22) {
                            switch(hours) {
                                case 18:
                                    this.backgroundColor = '#99DDDD';
                                    break;
                                case 19:
                                    this.backgroundColor = '#77BBBB';
                                    break;
                                case 20:
                                    this.backgroundColor = '#559999';
                                    break;
                                case 21:
                                    this.backgroundColor = '#225555';
                                    break;
                                case 22:
                                    this.backgroundColor = '#111122';
                                    break;
                            }
                        } else {
                            // Day
                            this.backgroundColor = '#BBFFFF';
                        }
                    },
                    
                    rotateObjects: function(degrees) {
                        this.world.rotate(degrees);
                        for(var i=0;i<this.npcs.length; i++) {
                            this.npcs[i].rotate(degrees);
                            this.npcs[i].updatePosition(this.world);
                        }
                    },
                    
                    animateObjects: function(elapsed) {
                        this.timeElapsedObjects += elapsed * 0.001;
                        if(this.timeElapsedObjects >= this.objectUpdateSpeed) {
                            for(var i=0;i<this.npcs.length; i++) {
                                this.npcs[i].frame++;
                            }
                            this.timeElapsedObjects -= this.objectUpdateSpeed;
                        }
                    },
                    
                    animateChar: function(elapsed) {
                        this.timeElapsedChar += elapsed * 0.001;
                        if(this.timeElapsedChar >= this.charUpdateSpeed) {
                            this.char.frame++;
                            this.timeElapsedChar -= this.charUpdateSpeed;
                        }
                    },
                    
                    onTouchStart: function(e) {
                        game.replaceScene(game.scenes.start);
                    },
                    onEnterFrame: function(e) {
                        this.clock.onEnterFrame(e);
                        this.updateSkyColor();
                        this.timeElapsed = this.animateObjects(e.elapsed);
                        if(this.rightButtonDown) {
                            this.rotateObjects(-1 * this.worldRotationSpeed);
                            this.animateChar(e.elapsed);
                        } else if(this.leftButtonDown) {
                            this.rotateObjects(this.worldRotationSpeed);
                            this.animateChar(e.elapsed);
                        }
                    },
                    onRightButtonDown: function(e) {
                        if(!this.rightButtonDown) {
                            this.rightButtonDown = true;
                            //this.char.frame = [0,1,2,3,4,5,6,9,10,11];
                            this.char.turn(1);
                        }
                    },
                    onRightButtonUp: function(e) {
                        if(this.rightButtonDown) {
                            this.rightButtonDown = false;
                            this.char.frame = 0;
                        }
                    },
                    onLeftButtonDown: function(e) {
                        if(!this.leftButtonDown) {
                            this.leftButtonDown = true;
                            //this.char.frame = [0,1,2,3,4,5,6,9,10,11];
                            this.char.turn(-1);
                        }
                    },
                    onLeftButtonUp: function(e) {
                        if(this.leftButtonDown) {
                            this.leftButtonDown = false;
                            this.char.frame = 0;
                        }
                    }
                });
                
                var World = Class.create(Sprite, {
                   game: Game.instance,
                   initialize: function(width, height, image) {
                        Sprite.apply(this, [width, height]);
                        if(typeof image === 'string') {
                            this.image = game.assets[image];
                        } else if(typeof image === 'object') {
                            this.image = image;
                        }
                        this.radius = width / 2;
                        this.scaleX = 1;
                        this.scaleY = 1;
                        this.x = gamediv.width() / 2 - this.width / 2;
                        this.y = -300;
                   }
                });
                
                var Character = Class.create(Sprite, {
                    game: Game.instance,
                    initialize: function(width, height, image) {
                        Sprite.apply(this, [width, height]);
                        if(typeof image === 'string') {
                            this.image = game.assets[image];
                        } else if(typeof image === 'object') {
                            this.image = image;
                        } else {
                            this.image = game.assets['img/tipu_1000x732.gif'];
                            this.frame = [0,1,2,3,4,5,6,9,10,11];
                        }
                        
                        this.scaleX = 0.25;
                        this.scaleY = 0.25;
                        this.direction = 1;
                        this.x = gamediv.width() / 2 - this.width / 2;
                        this.y = 100;
                    },
                    turn: function(dir) {
                        if(this.direction !== dir) {
                            this.direction = -1 * this.direction;
                            this.scaleX = this.scaleX * -1;
                        }
                    },
                    onEnterFrame: function(e) {
                        //this.rotate(1);
                    }
                });
                
                var GameObject = Class.create(Sprite, {
                    game: Game.instance,
                    initialize: function(width, height, image) {
                        Sprite.apply(this, [width, height]);
                        if(typeof image === 'string') {
                            this.image = game.assets[image];
                        } else if(typeof image === 'object') {
                            this.image = image;
                        }
                        this.x = gamediv.width() / 2 - this.width / 2;
                        this.scaleX = 0.1;
                        this.scaleY = 0.1;
                        this.distance = 1750;
                    },
                    updatePosition: function(world) {
                        this.origX = world.x + world.width / 2 - this.width/2;
                        this.origY = world.y + world.height / 2 - this.height/2;
                        this.x = this.origX + this.distance * Math.sin(this.rotation * Math.PI / 180);
                        this.y = this.origY - this.distance * Math.cos(this.rotation * Math.PI / 180);
                    }
                });
                
                var TitleLabel = Class.create(Label, {
                    game: Game.instance,
                    initialize: function(text) {
                        Label.apply(this, [text]);
                        //this.text = text;
                        this.font = '32px Comic Sans MS';
                        this.color = 'green';
                        this.backgroundColor = '#000000';
                        this.textAlign = 'center';
                        this.width = text.length * 17;
                        this.x = gamediv.width() / 2 - this.width / 2;
                    }
                });
                
                var Clock = Class.create(Label, {
                    game: Game.instance,
                    initialize: function() {
                        Label.apply(this, ['00:00']);
                        
                        this.hours = 8;
                        this.minutes = 0;
                        this.time = 0;
                        
                        this.font = "32px Comic Sans MS";
                        
                        this.timeSpeed = 2;
                        this.updateClock();
                    },
                    updateClock: function() {
                        var hourText = this.hours > 9 ? this.hours : "0" + this.hours;
                        var minText = this.minutes > 9 ? this.minutes : "0" + this.minutes;
                        
                        this.text = hourText + ":" + minText;
                    },
                    onEnterFrame: function(e) {
                        this.time += e.elapsed * 0.001;
                        if(this.time >= this.timeSpeed) {
                            this.minutes = (this.minutes + 15) % 60;
                            if(this.minutes === 0) {
                                this.hours = (this.hours + 1) % 24;
                            }
                            this.time -= this.timeSpeed;
                            this.updateClock();
                        }
                    }
                });
                
                var Dialog = Class.create(Label, {
                    game: Game.instance,
                    initialize: function(text) {
                        Label.apply(this, [text]);
                        
                        this.backgroundColor = 'white';
                        this.textAlign = 'center';
                        this.width = text.length * 17;
                        this.x = gamediv.width() / 2 - this.width / 2;
                        this.y = 150;
                        this.font = "32px Comic Sans MS";
                    }
                });
            };
        </script>
    </body>
</html>
